pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
-- A game by fufferpuffer
--2024

--this one is the test build. Feel free to break it to shit!

function _init()
    gravity=0.3
    friction=0.85  
    
end

function _update()
    shoot()
    player.dy+=gravity
    player.dx*=friction
    player_move()
end

function _draw()
    cls()
    for o in all(objs) do o:draw() end
    spr(player.sprite,player.x,player.y)

    --temp ground
    rectfill(0,118,127,127,13)
    
end

--all player functions and tables go here

player = {
    x = 10,
    y = 110,
    dx = 0,
    dy = 0,
    max_dx=2,
    max_dy=3,
    acc=0.5,
    boost=4,
    health = 3,
    sprite = 0,
    abilities = {
        can_double_jump = false,
        can_dash = false
    },
    has_double_jumped = false,
    
}

anims = {
    idle={fr=15,0,1},
    walkright={fr=2,3,4,5},
    walkleft={fr=-2,-3,-4,-5}
}
--bullet stuff here
objs={} --table for storing bullets
function objdraw(o)
    spr(o.spr,o.x,o.y)
end

function bulletupdate(b)
    b.x += b.dx
    b.y += b.dy
    b.time -= 1
    return b.time > 0
end

function newbullet(x,y,w,h,dx,dy)
    local b = {
        x=x,y=y,dx=dx,dy=dy,
        w=w,h=h,
        time=60,
        update=bulletupdate,
        spr=0,draw=objdraw   
    }
    add(objs,b)
    return b    
end

function shoot()
    if(btnp(4)) newbullet(0,64,4,4,2,0)
    local i,j=1,1
    while(objs[i]) do
        if objs[i]:update() then
            if(i!=j) objs[j]=objs[i] objs[i]=nil
            j+=1
        else objs[i]=nil
        end
        i+=1
    end
    
end

--end of bullet stuff

function player_move()
    if (btn(0)) then player.dx-=player.acc end -- left
    if (btn(1)) then player.dx+=player.acc end -- right
    if (btnp(5)) then player.dy-=player.boost end -- X

    --limit left/right speed
    player.dx=mid(-player.max_dx,player.dx,player.max_dx)
    --limit fall speed
    if (player.dy>0) then
        player.dy=mid(-player.max_dy,player.dy,player.max_dy)
    end

     --apply dx and dy to player position
     player.x+=player.dx
     player.y+=player.dy
 
     --simple ground collision
     if (player.y>110) then player.y=110 player.dy=0 end
 
     --if run off screen warp to other side
     if (player.x>128) then player.x=-8 end
     if (player.x<-8) then player.x=128 end
    
end




__gfx__
00333000000000000033300000333000003330000033300000000000000000000000000000000000000000000000000000000000000000000000000000000000
003cc00000333000003cc000003cc000003cc000003cc00000000000000000000000000000000000000000000000000000000000000000000000000000000000
00333000003cc0000033300000333000003330000033300000000000000000000000000000000000000000000000000000000000000000000000000000000000
00030080003330000003008000030080000300800003008000000000000000000000000000000000000000000000000000000000000000000000000000000000
00bab7700003008000bab77000bab77000bab77000bab77000000000000000000000000000000000000000000000000000000000000000000000000000000000
00bab00000bab77000bab00000bab00000bab00000bab00000000000000000000000000000000000000000000000000000000000000000000000000000000000
0030300000bab0000030330000303000003030000033300000000000000000000000000000000000000000000000000000000000000000000000000000000000
00303000003030000030000000300300000330000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000066696a00666a690000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000c8ccc600c8ccc60000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000800000000000666a690066696a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00005000000055800005000000050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00050000000500000005000000666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
099a6d6d099a6d6d0066600000d5d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06d6d6d606d6d6d606d5d60006d5d600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05500055055000550066600000666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000d5dddd5dd5dddd5d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00044000500660055a00a00500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000dd000d060060dd0a00a0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00d11d00d600006ddaaaaaad00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00d1cd00d006600ddaaaaaad00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d1c11d0d060060dd0a00a0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0dc111d0560000655a00a00500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0dddddd0d5dddd5dd5dddd5d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
65666776000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
65566667000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000000000000000000000000000000000000000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
